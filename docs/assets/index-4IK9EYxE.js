import{r as te,j as t,R as ye,c as Ce}from"./react-jfyNKTSf.js";import{I as Ie,B as m,L as be,G,a as Re,T as d,S as W,C as p,H as x,b as se,c as re,d as k,e as $,R as z,E as Pe,A as we,f as Ae,D as Ee,M as D,U as Le,g as ke,h as $e,i as _e,j as Te,k as Ve}from"./tinywidgets-MvWbyqMN.js";import{c as v,a as b,b as R,U as j,e as He,P as Ne,I as Oe}from"./tinybase-Dd_s44Mp.js";import{O as Ue}from"./octokit-C51hKPwz.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function a(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=a(o);fetch(o.href,n)}})();const g=new Ue({auth:localStorage.getItem("token")}),ae=()=>localStorage.getItem("token")!=null,_=6e4,S={per_page:100},F="user",De={name:{type:"string"},avatarUrl:{type:"string"}},{useCreateStore:Ge,useProvideStore:ze,useCreatePersister:J,useValue:Fe,useSetValueCallback:bs}=j,M=e=>Fe(e,F),Me=()=>{const e=Ge(()=>v().setValuesSchema(De));return J(e,s=>b(s,F),[],async s=>{await s.startAutoLoad(),await s.startAutoSave()}),J(e,Be,[],async s=>{await(s==null?void 0:s.load())},[]),ze(F,e),null},Be=e=>R(e,async()=>{if(ae()){const s=await g.rest.users.getAuthenticated();if(s.status==200){const{name:a,login:r,avatar_url:o}=s.data;return[{},{name:a??r,avatarUrl:o}]}}return[{},{}]},async()=>{},s=>setInterval(s,_),s=>clearInterval(s)),X="view",qe={repoId:{type:"string",default:""},issueId:{type:"string",default:""}},{useCreateStore:We,useProvideStore:Xe,useCreatePersister:Ke,useValue:Ze,useSetValueCallback:Je}=j,h=e=>Ze(e,X),T=(e,s,a)=>Je(e,s,a,X),Qe=()=>{const e=We(()=>v().setValuesSchema(qe));return Ke(e,s=>R(s,async()=>{const[a,r,o]=location.hash.slice(1).split("/");return[{},{repoId:a&&r?a+"/"+r:"",issueId:o}]},async a=>{const{repoId:r,issueId:o}=a()[1];location.hash=r+"/"+o},a=>{const r=()=>a();return window.addEventListener("hashchange",r),r},a=>window.removeEventListener("hashchange",a)),[],async s=>{await s.startAutoLoad(),await s.startAutoSave()}),Xe(X,e),null},Ye="#181717",et=te.forwardRef(function({title:s="GitHub",color:a="currentColor",size:r=24,...o},n){return a==="default"&&(a=Ye),t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:r,fill:a,viewBox:"0 0 24 24",ref:n,...o,children:[t.jsx("title",{children:s}),t.jsx("path",{d:"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"})]})});var tt="zhil3w0";const st=()=>location.assign("auth.html"),rt=()=>location.assign("auth.html?logout"),oe=()=>{const e=M("name"),s=M("avatarUrl");return e?t.jsxs("div",{className:tt,children:[s?t.jsx(Ie,{variant:"avatar",src:s,alt:e}):null,t.jsx(m,{onClick:rt,icon:be,title:"Logout"})]}):t.jsx(m,{onClick:st,icon:et,title:"Login",variant:"accent"})};var at="_1ul10dk0",ot="_1ul10dk1";const{createElement:Rs,Fragment:Ps,useEffect:ne,useRef:ie,useState:ws}=ye,le={behavior:"instant",block:"nearest"},P=e=>e<1e3?e:(e/1e3).toFixed(e<1e4?1:0)+(e<1e3?"":"k"),A=e=>new Date(e).toLocaleDateString(),E="settings",nt={reposSortCell:{type:"string",default:"stars"},issuesSortCell:{type:"string",default:"updatedAt"}},{useCreateStore:it,useProvideStore:lt,useCreatePersister:ct,useValue:ut,useSetValueCallback:dt}=j,V=e=>ut(e,E),ce=(e,s,a)=>dt(e,s,a,E),pt=()=>{const e=it(()=>v().setValuesSchema(nt));return ct(e,s=>b(s,E),[],async s=>{await s.startAutoLoad(),await s.startAutoSave()}),lt(E,e),null},B="repos",ue="repos",K="repos",Z="reposByGroup",de="repos",ht={repos:{group:{type:"string",default:""},owner:{type:"string",default:""},name:{type:"string",default:""},createdAt:{type:"string",default:""},fork:{type:"boolean",default:!1},forksCount:{type:"number",default:0},openIssuesCount:{type:"number",default:0},stargazersCount:{type:"number",default:0},updatedAt:{type:"string",default:""}}},{useCell:gt,useCreatePersister:Q,useCreateStore:ft,useProvideStore:St,useCreateIndexes:mt,useProvidePersister:xt,useProvideIndexes:vt,useSliceRowIds:jt,usePersisterStatus:yt,useSliceIds:Ct}=j,w=(e,s)=>gt(ue,e,s,B),It=()=>Ct(Z,K),bt=e=>jt(Z,e,K),Rt=()=>yt(de),Pt=()=>{const e=ft(()=>v().setTablesSchema(ht));St(B,e);const s=V("reposSortCell"),a=s=="name"||s=="fork"?1:-1,r=mt(e,n=>He(n).setIndexDefinition(Z,ue,"group",s,void 0,(l,c)=>(l>c?1:-1)*a),[s]);vt(K,r),Q(e,n=>b(n,B),[],async n=>{await n.startAutoLoad(),await n.startAutoSave()});const o=Q(e,n=>wt(n),[],async n=>{await(n==null?void 0:n.load())},[]);return xt(de,o),null},wt=e=>R(e,async()=>{if(ae()){const s={},a=({full_name:r,owner:o,name:n,created_at:l,fork:c,forks_count:y,open_issues_count:C,stargazers_count:I,updated_at:H},N=o.login)=>{s[r]={group:N,owner:o.login,name:n,createdAt:l??"",fork:c,forksCount:y??0,openIssuesCount:C??0,stargazersCount:I??0,updatedAt:H??""}};return(await g.rest.activity.listReposStarredByAuthenticatedUser(S)).data.forEach(r=>a(r,"Starred")),(await g.rest.repos.listForAuthenticatedUser(S)).data.forEach(r=>a(r)),await Promise.all((await g.rest.orgs.listForAuthenticatedUser(S)).data.map(async({login:r})=>{(await g.rest.repos.listForOrg({org:r,...S})).data.forEach(n=>a(n))})),[{repos:s},{}]}return[{},{}]},async()=>{},s=>setInterval(s,_),s=>clearInterval(s)),f=({repoId:e,isCurrent:s=!1,hardcodedName:a})=>{const r=T("repoId",()=>e,[e]),o=ie(null);ne(()=>{var c;s&&((c=o.current)==null||c.scrollIntoView(le))},[s]);const n=w(e,"name"),l=w(e,"stargazersCount");return t.jsx(m,{variant:"item",ref:o,onClick:r,icon:w(e,"fork")?G:Re,title:a??n,titleRight:a?null:t.jsx(d,{icon:W,title:P(l)}),current:s})},At=()=>t.jsxs(p,{className:at,children:[t.jsx("img",{src:"/favicon.svg",alt:"TinyHub logo",className:ot}),t.jsx("h2",{children:"Welcome to TinyHub"}),t.jsx("p",{children:"Navigate to your own repos from the sidebar, or go directly to one of the popular ones below."}),t.jsx(x,{}),t.jsx(f,{repoId:"facebook/react",hardcodedName:"React"}),t.jsx(f,{repoId:"vuejs/vue",hardcodedName:"Vue"}),t.jsx(f,{repoId:"tensorflow/tensorflow",hardcodedName:"TensorFlow"}),t.jsx(f,{repoId:"torvalds/linux",hardcodedName:"Linux"}),t.jsx(f,{repoId:"ohmyzsh/ohmyzsh",hardcodedName:"Oh My Zsh"})]}),L="issues",pe="issues",he="issues",Et={issues:{title:{type:"string",default:""},pullRequest:{type:"boolean",default:!1},bodyHtml:{type:"string",default:""},createdAt:{type:"string",default:""},updatedAt:{type:"string",default:""}}},{useCreateStore:Lt,useProvideStore:kt,useCreatePersister:Y,useCell:$t,useProvidePersister:_t,useSetCellCallback:As,useSortedRowIds:Tt,usePersisterStatus:Vt}=j,u=(e,s)=>$t(pe,e,s,L),Ht=(e,s)=>Tt(pe,e,s,void 0,void 0,L),Nt=()=>Vt(he),Ot=()=>{const e=h("repoId"),s=Lt(()=>v().setTablesSchema(Et),[e]);kt(L,s),Y(s,r=>{if(e)return b(r,e+"/"+L)},[e],async r=>{await(r==null?void 0:r.startAutoLoad()),await(r==null?void 0:r.startAutoSave())},[]);const a=Y(s,r=>{if(e)return Ut(r,e)},[e],async r=>{await(r==null?void 0:r.load())},[]);return _t(he,a),null},Ut=(e,s)=>R(e,async()=>{const[a,r]=s.split("/"),o={};return(await g.rest.issues.listForRepo({owner:a,repo:r,mediaType:{format:"html"},...S})).data.forEach(({number:n,title:l,pull_request:c,body_html:y,created_at:C,updated_at:I})=>o[n]={title:l,pullRequest:c!=null,bodyHtml:y??"",createdAt:C,updatedAt:I}),[{issues:o},{}]},async()=>{},a=>setInterval(a,_),a=>clearInterval(a));var Dt="_1nl4udb0",Gt="_1nl4udb1";const zt=({issueId:e})=>t.jsxs(t.Fragment,{children:[t.jsxs(se,{icon:u(e,"pullRequest")?re:k,children:[t.jsx("h2",{children:u(e,"title")}),t.jsxs("p",{children:["Created ",A(u(e,"createdAt")),"."]}),t.jsxs("p",{children:["Updated ",A(u(e,"updatedAt")),"."]})]}),t.jsx(x,{}),t.jsx("div",{dangerouslySetInnerHTML:{__html:u(e,"bodyHtml")??""}})]}),Ft=({issueId:e,isCurrent:s})=>{const a=T("issueId",()=>e,[e]),r=ie(null);return ne(()=>{var o;s&&((o=r.current)==null||o.scrollIntoView(le))},[s]),t.jsx(m,{variant:"item",ref:r,onClick:a,icon:u(e,"pullRequest")?re:k,title:u(e,"title"),titleRight:t.jsx(d,{title:`#${e}`}),current:s})},Mt=({currentIssueId:e,issueIds:s})=>s.map(a=>t.jsx(Ft,{issueId:a,isCurrent:a==e},a)),Bt=()=>{const e=h("repoId"),s=h("issueId"),a=V("issuesSortCell"),r=a=="title",o=Ht(a,!r),n=T("issueId",l=>l);return te.useEffect(()=>{o.length>0&&(s==""||!o.includes(s))&&n(o[0])},[o,s,n]),t.jsx($,{id:"issues",title:"Issues",titleRight:t.jsx(d,{icon:k,variant:"accent",title:w(e,"openIssuesCount")}),children:t.jsxs(z,{variant:"1|2",children:[t.jsx(p,{className:Dt,children:t.jsx(Mt,{currentIssueId:s,issueIds:o})}),u(s,"title")?t.jsx(p,{className:Gt,children:t.jsx(zt,{issueId:s})}):null]})})};var qt="wm8fek2";const q="repo",ge="repo",Wt={id:{type:"string",default:""},owner:{type:"string",default:""},avatarUrl:{type:"string",default:""},name:{type:"string",default:""},archived:{type:"boolean",default:!1},createdAt:{type:"string",default:""},description:{type:"string",default:""},disabled:{type:"boolean",default:!1},fork:{type:"boolean",default:!1},forksCount:{type:"number",default:0},homepage:{type:"string",default:""},language:{type:"string",default:""},license:{type:"string",default:""},openIssuesCount:{type:"number",default:0},size:{type:"number",default:0},stargazersCount:{type:"number",default:0},topics:{type:"string",default:""},updatedAt:{type:"string",default:""},visibility:{type:"string",default:""}},{useCreateStore:Xt,useProvideStore:Kt,useCreatePersister:ee,usePersisterStatus:Zt,useValue:Jt,useProvidePersister:Qt}=j,i=e=>Jt(e,q),Yt=()=>Zt(ge),es=()=>{const e=h("repoId"),s=Xt(()=>v().setValuesSchema(Wt),[e]);Kt(q,s),ee(s,r=>{if(e)return b(r,e+"/"+q)},[e],async r=>{await(r==null?void 0:r.startAutoLoad()),await(r==null?void 0:r.startAutoSave())},[]);const a=ee(s,r=>{if(r&&e)return ts(r,e)},[e],async r=>{await(r==null?void 0:r.load())},[]);return Qt(ge,a),null},ts=(e,s)=>R(e,async()=>{const[a,r]=s.split("/"),{owner:o,name:n,archived:l,created_at:c,description:y,disabled:C,fork:I,forks_count:H,homepage:N,language:fe,license:O,open_issues_count:Se,size:me,stargazers_count:xe,topics:U,updated_at:ve,visibility:je}=(await g.rest.repos.get({owner:a,repo:r,...S})).data;return[{},{id:o.login+"/"+n,owner:o.login,avatarUrl:o.avatar_url,name:n,archived:l??!1,createdAt:c??"",description:y??"",disabled:C??!1,fork:I,forksCount:H??0,homepage:N??"",language:fe??"",license:(O==null?void 0:O.name)??"",openIssuesCount:Se??0,size:me??0,stargazersCount:xe??0,topics:(U==null?void 0:U.join(", "))??"",updatedAt:ve??"",visibility:je??""}]},async()=>{},a=>setInterval(a,_),a=>clearInterval(a)),ss=()=>{const e=i("homepage");return t.jsxs($,{title:t.jsx("b",{children:"Summary"}),titleRight:t.jsxs("div",{className:qt,children:[t.jsx(d,{title:i("visibility"),icon:Pe,variant:"accent"}),i("fork")?t.jsx(d,{title:"fork",icon:G,variant:"accent"}):null,i("archived")?t.jsx(d,{title:"archived",icon:we,variant:"accent"}):null,i("disabled")?t.jsx(d,{title:"disabled",icon:Ae,variant:"accent"}):null]}),id:"repoHeader",startOpen:!0,children:[t.jsxs(z,{variant:"2|1",children:[t.jsxs(se,{src:i("avatarUrl"),children:[t.jsx("h2",{children:i("name")}),t.jsx("p",{children:i("description")}),t.jsxs("p",{children:["Created ",A(i("createdAt")),", updated"," ",A(i("updatedAt")),"."]}),e?t.jsx("p",{children:t.jsx("a",{href:e,target:"_blank",rel:"noreferrer",children:e})}):null]}),t.jsx(p,{children:t.jsx(Ee,{data:{Owner:i("owner"),Language:i("language"),License:i("license")}})})]}),t.jsx(x,{}),t.jsxs(z,{variant:"1|1|1",children:[t.jsx(p,{children:t.jsx(D,{icon:W,title:"Stars",number:P(i("stargazersCount"))})}),t.jsx(p,{children:t.jsx(D,{icon:G,title:"Forks",number:P(i("forksCount"))})}),t.jsx(p,{children:t.jsx(D,{icon:k,title:"Issues",number:P(i("openIssuesCount"))})})]})]})},rs=()=>{const e=h("repoId"),s=i("id");return e==s?t.jsxs(t.Fragment,{children:[t.jsx(ss,{}),t.jsx(Bt,{})]}):null},as={title:"title",createdAt:"most recently created",updatedAt:"most recently updated",pullRequest:"pull requests then issues"},os=()=>{const e=V("issuesSortCell"),s=ce("issuesSortCell",a=>a.target.value,[]);return t.jsxs("div",{children:[t.jsx("label",{children:"Issues sorted by"}),t.jsx("select",{onChange:s,value:e,children:Object.entries(as).map(([a,r])=>t.jsx("option",{value:a,children:r},a))})]})},ns=({group:e,currentRepoId:s})=>{const a=bt(e);return t.jsx($,{id:`repoGroup/${e}`,icon:e=="Starred"?W:Le,title:e,titleRight:t.jsx(d,{variant:"accent",title:a.length}),children:a.map(r=>t.jsx(f,{repoId:r,isCurrent:r==s},r))},e)},is=()=>{const e=h("repoId");return It().map(s=>t.jsx(ns,{group:s,currentRepoId:e},s))},ls={name:"name",stargazersCount:"stars",forksCount:"forks",openIssuesCount:"issues",createdAt:"most recently created",updatedAt:"most recently updated",fork:"repos then forks"},cs=()=>{const e=V("reposSortCell"),s=ce("reposSortCell",a=>a.target.value,[]);return t.jsxs("div",{children:[t.jsx("label",{children:"Repos sorted by"}),t.jsx("select",{onChange:s,value:e,children:Object.entries(ls).map(([a,r])=>t.jsx("option",{value:a,children:r},a))})]})},us=()=>{const e=h("repoId"),s=T("repoId",()=>"");return t.jsxs(t.Fragment,{children:[t.jsx(m,{variant:"item",onClick:s,icon:ke,title:"Home",current:!e}),t.jsx(x,{}),t.jsx(is,{}),t.jsx(x,{}),t.jsxs($,{icon:$e,title:"Settings",children:[t.jsx(cs,{}),t.jsx(os,{})]})]})};var ds="_1cl0umd0",ps="_1cl0umd1",hs="_1cl0umd2";const gs=()=>{const e=Rt()+Yt()+Nt();return t.jsxs(t.Fragment,{children:[t.jsx("img",{src:"/favicon.svg",alt:"TinyHub logo",className:_e(ds,e>0&&ps)}),t.jsx("h1",{children:"TinyHub"}),t.jsx(m,{variant:"icon",icon:Te,href:"https://github.com/tinyplex/tinyhub",alt:"A local-first GitHub client, built in public.",className:hs})]})};var fs="yugd9z0",Ss="yugd9z1";const ms=()=>t.jsxs(p,{className:fs,children:[t.jsx("img",{src:"/favicon.svg",alt:"TinyHub logo",className:Ss}),t.jsx("h2",{children:"Welcome to TinyHub"}),t.jsx("p",{children:"TinyHub is a local-first GitHub client, built in public."}),t.jsx(x,{}),t.jsx("p",{children:"Login with GitHub to get started."}),t.jsx(oe,{})]}),xs=()=>t.jsxs(Ne,{children:[t.jsx(Me,{}),t.jsx(Pt,{}),t.jsx(es,{}),t.jsx(Ot,{}),t.jsx(Qe,{}),t.jsx(pt,{}),t.jsx(vs,{}),t.jsx(Oe,{})]}),vs=()=>{const e=M("name"),s=h("repoId");return t.jsx(Ve,{title:t.jsx(gs,{}),topNavRight:t.jsx(oe,{}),sideNav:e?t.jsx(us,{}):null,main:e?s?t.jsx(rs,{}):t.jsx(At,{}):t.jsx(ms,{})})};addEventListener("load",()=>Ce(document.getElementById("app")).render(t.jsx(xs,{})));
