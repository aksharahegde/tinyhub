import{r as te,j as t,R as ye,c as Ie}from"./react-NscsqV4B.js";import{U as v,c as j,b,a as R,e as Ce,P as be,I as Re}from"./tinybase-BY1S4Wu4.js";import{I as Pe,B as S,L as we,G,a as Ae,T as d,S as W,C as p,H as x,b as se,c as re,d as $,e as k,R as z,D as Ee,M as D,E as Le,A as $e,f as ke,U as _e,g as Te,h as He,i as Ne,j as Oe,k as Ve}from"./tinywidgets-D5EI_PB-.js";import{O as Ue}from"./octokit-C19Y2PxH.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function a(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=a(o);fetch(o.href,n)}})();const _=6e4,m={per_page:100},g=new Ue({auth:localStorage.getItem("token")}),ae=()=>localStorage.getItem("token")!=null,X="view",De={repoId:{type:"string",default:""},issueId:{type:"string",default:""}},{useCreateStore:Ge,useProvideStore:ze,useCreatePersister:Fe,useValue:Me,useSetValueCallback:Be}=v,h=e=>Me(e,X),T=(e,s,a)=>Be(e,s,a,X),qe=()=>{const e=Ge(()=>j().setValuesSchema(De));return Fe(e,s=>b(s,async()=>{const[a,r,o]=location.hash.slice(1).split("/");return[{},{repoId:a&&r?a+"/"+r:"",issueId:o}]},async a=>{const{repoId:r,issueId:o}=a()[1];location.hash=r+"/"+o},a=>{const r=()=>a();return window.addEventListener("hashchange",r),r},a=>window.removeEventListener("hashchange",a)),[],async s=>{await s.startAutoLoad(),await s.startAutoSave()}),ze(X,e),null},A="issues",oe="issues",ne="issues",We={issues:{title:{type:"string",default:""},pullRequest:{type:"boolean",default:!1},bodyHtml:{type:"string",default:""},createdAt:{type:"string",default:""},updatedAt:{type:"string",default:""}}},{useCreateStore:Xe,useProvideStore:Ke,useCreatePersister:J,useCell:Ze,useProvidePersister:Je,useSortedRowIds:Qe,usePersisterStatus:Ye}=v,u=(e,s)=>Ze(oe,e,s,A),et=(e,s)=>Qe(oe,e,s,void 0,void 0,A),tt=()=>Ye(ne),st=()=>{const e=h("repoId"),s=Xe(()=>j().setTablesSchema(We),[e]);Ke(A,s),J(s,r=>{if(e)return R(r,e+"/"+A)},[e],async r=>{await(r==null?void 0:r.startAutoLoad()),await(r==null?void 0:r.startAutoSave())},[]);const a=J(s,r=>{if(e)return rt(r,e)},[e],async r=>{await(r==null?void 0:r.load())},[]);return Je(ne,a),null},rt=(e,s)=>b(e,async()=>{const[a,r]=s.split("/"),o={};return(await g.rest.issues.listForRepo({owner:a,repo:r,mediaType:{format:"html"},...m})).data.forEach(({number:n,title:l,pull_request:c,body_html:y,created_at:I,updated_at:C})=>o[n]={title:l,pullRequest:c!=null,bodyHtml:y??"",createdAt:I,updatedAt:C}),[{issues:o},{}]},async()=>{},a=>setInterval(a,_),a=>clearInterval(a)),F="repo",ie="repo",at={id:{type:"string",default:""},owner:{type:"string",default:""},avatarUrl:{type:"string",default:""},name:{type:"string",default:""},archived:{type:"boolean",default:!1},createdAt:{type:"string",default:""},description:{type:"string",default:""},disabled:{type:"boolean",default:!1},fork:{type:"boolean",default:!1},forksCount:{type:"number",default:0},homepage:{type:"string",default:""},language:{type:"string",default:""},license:{type:"string",default:""},openIssuesCount:{type:"number",default:0},size:{type:"number",default:0},stargazersCount:{type:"number",default:0},topics:{type:"string",default:""},updatedAt:{type:"string",default:""},visibility:{type:"string",default:""}},{useCreateStore:ot,useProvideStore:nt,useCreatePersister:Q,usePersisterStatus:it,useValue:lt,useProvidePersister:ct}=v,i=e=>lt(e,F),ut=()=>it(ie),dt=()=>{const e=h("repoId"),s=ot(()=>j().setValuesSchema(at),[e]);nt(F,s),Q(s,r=>{if(e)return R(r,e+"/"+F)},[e],async r=>{await(r==null?void 0:r.startAutoLoad()),await(r==null?void 0:r.startAutoSave())},[]);const a=Q(s,r=>{if(r&&e)return pt(r,e)},[e],async r=>{await(r==null?void 0:r.load())},[]);return ct(ie,a),null},pt=(e,s)=>b(e,async()=>{const[a,r]=s.split("/"),{owner:o,name:n,archived:l,created_at:c,description:y,disabled:I,fork:C,forks_count:N,homepage:O,language:fe,license:V,open_issues_count:me,size:Se,stargazers_count:xe,topics:U,updated_at:ve,visibility:je}=(await g.rest.repos.get({owner:a,repo:r,...m})).data;return[{},{id:o.login+"/"+n,owner:o.login,avatarUrl:o.avatar_url,name:n,archived:l??!1,createdAt:c??"",description:y??"",disabled:I??!1,fork:C,forksCount:N??0,homepage:O??"",language:fe??"",license:(V==null?void 0:V.name)??"",openIssuesCount:me??0,size:Se??0,stargazersCount:xe??0,topics:(U==null?void 0:U.join(", "))??"",updatedAt:ve??"",visibility:je??""}]},async()=>{},a=>setInterval(a,_),a=>clearInterval(a)),E="settings",ht={reposSortCell:{type:"string",default:"stars"},issuesSortCell:{type:"string",default:"updatedAt"}},{useCreateStore:gt,useProvideStore:ft,useCreatePersister:mt,useValue:St,useSetValueCallback:xt}=v,H=e=>St(e,E),le=(e,s,a)=>xt(e,s,a,E),vt=()=>{const e=gt(()=>j().setValuesSchema(ht));return mt(e,s=>R(s,E),[],async s=>{await s.startAutoLoad(),await s.startAutoSave()}),ft(E,e),null},M="repos",ce="repos",K="repos",Z="reposByGroup",ue="repos",jt={repos:{group:{type:"string",default:""},owner:{type:"string",default:""},name:{type:"string",default:""},createdAt:{type:"string",default:""},fork:{type:"boolean",default:!1},forksCount:{type:"number",default:0},openIssuesCount:{type:"number",default:0},stargazersCount:{type:"number",default:0},updatedAt:{type:"string",default:""}}},{useCell:yt,useCreatePersister:Y,useCreateStore:It,useProvideStore:Ct,useCreateIndexes:bt,useProvidePersister:Rt,useProvideIndexes:Pt,useSliceRowIds:wt,usePersisterStatus:At,useSliceIds:Et}=v,P=(e,s)=>yt(ce,e,s,M),Lt=()=>Et(Z,K),$t=e=>wt(Z,e,K),kt=()=>At(ue),_t=()=>{const e=It(()=>j().setTablesSchema(jt));Ct(M,e);const s=H("reposSortCell"),a=s=="name"||s=="fork"?1:-1,r=bt(e,n=>Ce(n).setIndexDefinition(Z,ce,"group",s,void 0,(l,c)=>(l>c?1:-1)*a),[s]);Pt(K,r),Y(e,n=>R(n,M),[],async n=>{await n.startAutoLoad(),await n.startAutoSave()});const o=Y(e,n=>Tt(n),[],async n=>{await(n==null?void 0:n.load())},[]);return Rt(ue,o),null},Tt=e=>b(e,async()=>{if(ae()){const s={},a=({full_name:r,owner:o,name:n,created_at:l,fork:c,forks_count:y,open_issues_count:I,stargazers_count:C,updated_at:N},O=o.login)=>{s[r]={group:O,owner:o.login,name:n,createdAt:l??"",fork:c,forksCount:y??0,openIssuesCount:I??0,stargazersCount:C??0,updatedAt:N??""}};return(await g.rest.activity.listReposStarredByAuthenticatedUser(m)).data.forEach(r=>a(r,"Starred")),(await g.rest.repos.listForAuthenticatedUser(m)).data.forEach(r=>a(r)),await Promise.all((await g.rest.orgs.listForAuthenticatedUser(m)).data.map(async({login:r})=>{(await g.rest.repos.listForOrg({org:r,...m})).data.forEach(n=>a(n))})),[{repos:s},{}]}return[{},{}]},async()=>{},s=>setInterval(s,_),s=>clearInterval(s)),B="user",Ht={name:{type:"string"},avatarUrl:{type:"string"}},{useCreateStore:Nt,useProvideStore:Ot,useCreatePersister:ee,useValue:Vt}=v,q=e=>Vt(e,B),Ut=()=>{const e=Nt(()=>j().setValuesSchema(Ht));return ee(e,s=>R(s,B),[],async s=>{await s.startAutoLoad(),await s.startAutoSave()}),ee(e,Dt,[],async s=>{await(s==null?void 0:s.load())},[]),Ot(B,e),null},Dt=e=>b(e,async()=>{if(ae()){const s=await g.rest.users.getAuthenticated();if(s.status==200){const{name:a,login:r,avatar_url:o}=s.data;return[{},{name:a??r,avatarUrl:o}]}}return[{},{}]},async()=>{},s=>setInterval(s,_),s=>clearInterval(s)),Gt="#181717",zt=te.forwardRef(function({title:s="GitHub",color:a="currentColor",size:r=24,...o},n){return a==="default"&&(a=Gt),t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:r,fill:a,viewBox:"0 0 24 24",ref:n,...o,children:[t.jsx("title",{children:s}),t.jsx("path",{d:"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"})]})});var Ft="zhil3w0";const Mt=()=>location.assign("auth.html"),Bt=()=>location.assign("auth.html?logout"),de=()=>{const e=q("name"),s=q("avatarUrl");return e?t.jsxs("div",{className:Ft,children:[s?t.jsx(Pe,{variant:"avatar",src:s,alt:e}):null,t.jsx(S,{onClick:Bt,icon:we,title:"Logout"})]}):t.jsx(S,{onClick:Mt,icon:zt,title:"Login",variant:"accent"})},{createElement:bs,Fragment:Rs,useEffect:pe,useRef:he,useState:Ps}=ye,ge={behavior:"instant",block:"nearest"},w=e=>e<1e3?e:(e/1e3).toFixed(e<1e4?1:0)+(e<1e3?"":"k"),L=e=>new Date(e).toLocaleDateString(),f=({repoId:e,isCurrent:s=!1,hardcodedName:a})=>{const r=T("repoId",()=>e,[e]),o=he(null);pe(()=>{var c;s&&((c=o.current)==null||c.scrollIntoView(ge))},[s]);const n=P(e,"name"),l=P(e,"stargazersCount");return t.jsx(S,{variant:"item",ref:o,onClick:r,icon:P(e,"fork")?G:Ae,title:a??n,titleRight:a?null:t.jsx(d,{icon:W,title:w(l)}),current:s})};var qt="_1ul10dk0",Wt="_1ul10dk1";const Xt=()=>t.jsxs(p,{className:qt,children:[t.jsx("img",{src:"/favicon.svg",alt:"TinyHub logo",className:Wt}),t.jsx("h2",{children:"Welcome to TinyHub"}),t.jsx("p",{children:"Navigate to your own repos from the sidebar, or go directly to one of the popular ones below."}),t.jsx(x,{}),t.jsx(f,{repoId:"facebook/react",hardcodedName:"React"}),t.jsx(f,{repoId:"vuejs/vue",hardcodedName:"Vue"}),t.jsx(f,{repoId:"tensorflow/tensorflow",hardcodedName:"TensorFlow"}),t.jsx(f,{repoId:"torvalds/linux",hardcodedName:"Linux"}),t.jsx(f,{repoId:"ohmyzsh/ohmyzsh",hardcodedName:"Oh My Zsh"})]});var Kt="_1nl4udb0",Zt="_1nl4udb1";const Jt=({issueId:e})=>t.jsxs(t.Fragment,{children:[t.jsxs(se,{icon:u(e,"pullRequest")?re:$,children:[t.jsx("h2",{children:u(e,"title")}),t.jsxs("p",{children:["Created ",L(u(e,"createdAt")),"."]}),t.jsxs("p",{children:["Updated ",L(u(e,"updatedAt")),"."]})]}),t.jsx(x,{}),t.jsx("div",{dangerouslySetInnerHTML:{__html:u(e,"bodyHtml")??""}})]}),Qt=({issueId:e,isCurrent:s})=>{const a=T("issueId",()=>e,[e]),r=he(null);return pe(()=>{var o;s&&((o=r.current)==null||o.scrollIntoView(ge))},[s]),t.jsx(S,{variant:"item",ref:r,onClick:a,icon:u(e,"pullRequest")?re:$,title:u(e,"title"),titleRight:t.jsx(d,{title:`#${e}`}),current:s})},Yt=({currentIssueId:e,issueIds:s})=>s.map(a=>t.jsx(Qt,{issueId:a,isCurrent:a==e},a)),es=()=>{const e=h("repoId"),s=h("issueId"),a=H("issuesSortCell"),r=a=="title",o=et(a,!r),n=T("issueId",l=>l);return te.useEffect(()=>{o.length>0&&(s==""||!o.includes(s))&&n(o[0])},[o,s,n]),t.jsx(k,{id:"issues",title:"Issues",titleRight:t.jsx(d,{icon:$,variant:"accent",title:P(e,"openIssuesCount")}),children:t.jsxs(z,{variant:"1|2",children:[t.jsx(p,{className:Kt,children:t.jsx(Yt,{currentIssueId:s,issueIds:o})}),u(s,"title")?t.jsx(p,{className:Zt,children:t.jsx(Jt,{issueId:s})}):null]})})};var ts="wm8fek2";const ss=()=>{const e=i("homepage");return t.jsxs(k,{title:t.jsx("b",{children:"Summary"}),titleRight:t.jsxs("div",{className:ts,children:[t.jsx(d,{title:i("visibility"),icon:Le,variant:"accent"}),i("fork")?t.jsx(d,{title:"fork",icon:G,variant:"accent"}):null,i("archived")?t.jsx(d,{title:"archived",icon:$e,variant:"accent"}):null,i("disabled")?t.jsx(d,{title:"disabled",icon:ke,variant:"accent"}):null]}),id:"repoHeader",startOpen:!0,children:[t.jsxs(z,{variant:"2|1",children:[t.jsxs(se,{src:i("avatarUrl"),children:[t.jsx("h2",{children:i("name")}),t.jsx("p",{children:i("description")}),t.jsxs("p",{children:["Created ",L(i("createdAt")),", updated"," ",L(i("updatedAt")),"."]}),e?t.jsx("p",{children:t.jsx("a",{href:e,target:"_blank",rel:"noreferrer",children:e})}):null]}),t.jsx(p,{children:t.jsx(Ee,{data:{Owner:i("owner"),Language:i("language"),License:i("license")}})})]}),t.jsx(x,{}),t.jsxs(z,{variant:"1|1|1",children:[t.jsx(p,{children:t.jsx(D,{icon:W,title:"Stars",number:w(i("stargazersCount"))})}),t.jsx(p,{children:t.jsx(D,{icon:G,title:"Forks",number:w(i("forksCount"))})}),t.jsx(p,{children:t.jsx(D,{icon:$,title:"Issues",number:w(i("openIssuesCount"))})})]})]})},rs=()=>{const e=h("repoId"),s=i("id");return e==s?t.jsxs(t.Fragment,{children:[t.jsx(ss,{}),t.jsx(es,{})]}):null},as={title:"title",createdAt:"most recently created",updatedAt:"most recently updated",pullRequest:"pull requests then issues"},os=()=>{const e=H("issuesSortCell"),s=le("issuesSortCell",a=>a.target.value,[]);return t.jsxs("div",{children:[t.jsx("label",{children:"Issues sorted by"}),t.jsx("select",{onChange:s,value:e,children:Object.entries(as).map(([a,r])=>t.jsx("option",{value:a,children:r},a))})]})},ns=({group:e,currentRepoId:s})=>{const a=$t(e);return t.jsx(k,{id:`repoGroup/${e}`,icon:e=="Starred"?W:_e,title:e,titleRight:t.jsx(d,{variant:"accent",title:a.length}),children:a.map(r=>t.jsx(f,{repoId:r,isCurrent:r==s},r))},e)},is=()=>{const e=h("repoId");return Lt().map(s=>t.jsx(ns,{group:s,currentRepoId:e},s))},ls={name:"name",stargazersCount:"stars",forksCount:"forks",openIssuesCount:"issues",createdAt:"most recently created",updatedAt:"most recently updated",fork:"repos then forks"},cs=()=>{const e=H("reposSortCell"),s=le("reposSortCell",a=>a.target.value,[]);return t.jsxs("div",{children:[t.jsx("label",{children:"Repos sorted by"}),t.jsx("select",{onChange:s,value:e,children:Object.entries(ls).map(([a,r])=>t.jsx("option",{value:a,children:r},a))})]})},us=()=>{const e=h("repoId"),s=T("repoId",()=>"");return t.jsxs(t.Fragment,{children:[t.jsx(S,{variant:"item",onClick:s,icon:Te,title:"Home",current:!e}),t.jsx(x,{}),t.jsx(is,{}),t.jsx(x,{}),t.jsxs(k,{icon:He,title:"Settings",children:[t.jsx(cs,{}),t.jsx(os,{})]})]})};var ds="_1cl0umd0",ps="_1cl0umd1",hs="_1cl0umd2";const gs=()=>{const e=kt()+ut()+tt();return t.jsxs(t.Fragment,{children:[t.jsx("img",{src:"/favicon.svg",alt:"TinyHub logo",className:Ne(ds,e>0&&ps)}),t.jsx("h1",{children:"TinyHub"}),t.jsx(S,{variant:"icon",icon:Oe,href:"https://github.com/tinyplex/tinyhub",alt:"A local-first GitHub client, built in public.",className:hs})]})};var fs="yugd9z0",ms="yugd9z1";const Ss=()=>t.jsxs(p,{className:fs,children:[t.jsx("img",{src:"/favicon.svg",alt:"TinyHub logo",className:ms}),t.jsx("h2",{children:"Welcome to TinyHub"}),t.jsx("p",{children:"TinyHub is a local-first GitHub client, built in public."}),t.jsx(x,{}),t.jsx("p",{children:"Login with GitHub to get started."}),t.jsx(de,{})]}),xs=()=>t.jsxs(be,{children:[t.jsx(Ut,{}),t.jsx(_t,{}),t.jsx(dt,{}),t.jsx(st,{}),t.jsx(qe,{}),t.jsx(vt,{}),t.jsx(vs,{}),t.jsx(Re,{})]}),vs=()=>{const e=q("name"),s=h("repoId");return t.jsx(Ve,{title:t.jsx(gs,{}),topNavRight:t.jsx(de,{}),sideNav:e?t.jsx(us,{}):null,main:e?s?t.jsx(rs,{}):t.jsx(Xt,{}):t.jsx(Ss,{})})};addEventListener("load",()=>Ie.createRoot(document.getElementById("app")).render(t.jsx(xs,{})));
